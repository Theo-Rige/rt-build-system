const e=document.querySelectorAll("#rtbs_component_libraries .rtbs-library"),t=document.querySelector("#rtbs_component_libraries .rtbs-library:last-child");function r(e,t){const r=e.querySelector(".rtbs-library-date"),l=e.querySelector('input[name*="[date]"]');if(r.classList.remove("rtbs-library-date--warning","rtbs-library-date--danger"),t){l.value=t.toLocaleDateString();const e=new Date,a=new Date(e),n=new Date(e);a.setMonth(e.getMonth()-6),n.setFullYear(e.getFullYear()-1),t<n?r.classList.add("rtbs-library-date--danger"):t<a&&r.classList.add("rtbs-library-date--warning")}else l.value="";r.classList.remove("rtbs-library-date--loading")}async function l(e,t){const l=function(e){const t=e.match(/github\.com\/([^\/]+)\/([^\/]+)/);return t?`${t[1]}/${t[2]}`:null}(t.value);if(e.querySelector(".rtbs-library-date").classList.add("rtbs-library-date--loading"),l&&t.checkValidity()){const t=await async function(e){try{const t=await fetch(`https://api.github.com/repos/${e}/releases/latest`);if(t.ok){const e=await t.json();return e.published_at?new Date(e.published_at):null}}catch(e){console.error("Error fetching release data:",e)}return null}(l);r(e,t)}else r(e,null)}if(e.forEach(((e,t)=>{const r=e.querySelector('input[name*="[repository]"]');r&&l(e,r)})),t){const a=t.cloneNode(!0);function n(e,t){const r=e.querySelectorAll("input"),l=e.querySelectorAll("label");r.forEach((e=>{if(e.name&&e.name.includes("rtbs_libraries[")){const r=e.name.match(/\[([^\]]+)\]$/)?.[1];r&&(e.name=`rtbs_libraries[${t}][${r}]`,e.id=`rtbs_libraries[${t}][${r}]`)}})),l.forEach((e=>{if(e.getAttribute("for")&&e.getAttribute("for").includes("rtbs_libraries[")){const r=e.getAttribute("for").match(/\[([^\]]+)\]$/)?.[1];r&&e.setAttribute("for",`rtbs_libraries[${t}][${r}]`)}}))}function o(e){const t=e.querySelectorAll("input"),r=e.querySelector('input[name*="[repository]"]');r&&r.addEventListener("blur",(()=>{console.log(`Fetching latest release date for repository: ${r.value}`),l(e,r)})),e.addEventListener("input",(()=>{if(Array.from(t).every((e=>e.checkValidity()&&e.value.length>0))){const t=e.parentNode.querySelectorAll(".rtbs-library");if(t[t.length-1]===e){const t=a.cloneNode(!0);n(t,document.querySelectorAll("#rtbs_component_libraries .rtbs-library").length),t.querySelectorAll("input").forEach((e=>e.value="")),e.parentNode.appendChild(t),o(t)}}else{const t=e.parentNode.querySelector(".rtbs-library:last-child");if(t&&t!==e){Array.from(t.querySelectorAll("input")).every((e=>0===e.value.length))&&t.remove()}}}))}o(t)}
//# sourceMappingURL=admin.min.js.map
