{"version":3,"file":"admin.min.js","names":["document","querySelectorAll","querySelector","updateLatestReleaseDateDisplay","entry","date","dateContainer","dateInput","classList","remove","value","toLocaleDateString","now","Date","sixMonthsAgo","oneYearAgo","setMonth","getMonth","setFullYear","getFullYear","add","async","getLatestReleaseDate","repositoryInput","repo","url","match","extractRepoFromUrl","checkValidity","releaseDate","response","fetch","ok","data","json","published_at","error","console","fetchLatestReleaseDate","addRepeatedEntryLogic","container","itemSelector","fieldPrefix","emptyEntryNode","entryInputs","addEventListener","log","Array","from","every","input","readOnly","length","allEntries","newEntry","cloneNode","nextIndex","getNextEntryIndex","index","inputs","labels","forEach","name","includes","fieldName","id","label","getAttribute","setAttribute","updateEntryAttributes","appendChild","lastEntry","initializeRepeatedFields","config","containerSelector","entries","emptyEntry"],"sources":["admin.js"],"mappings":"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","ignoreList":[],"sourcesContent":["const librariesEntries = document.querySelectorAll('#rtbs_component_libraries .rtbs-library')\nconst librariesEmptyEntry = document.querySelector('#rtbs_component_libraries .rtbs-library:last-child')\n\nfunction updateLatestReleaseDateDisplay(entry, date) {\n\tconst dateContainer = entry.querySelector('.rtbs-library-date')\n\tconst dateInput = entry.querySelector('input[name*=\"[date]\"]')\n\n\tdateContainer.classList.remove('rtbs-library-date--warning', 'rtbs-library-date--danger')\n\n\tif (date) {\n\t\tdateInput.value = date.toLocaleDateString()\n\n\t\tconst now = new Date()\n\t\tconst sixMonthsAgo = new Date(now)\n\t\tconst oneYearAgo = new Date(now)\n\t\tsixMonthsAgo.setMonth(now.getMonth() - 6)\n\t\toneYearAgo.setFullYear(now.getFullYear() - 1)\n\n\t\tif (date < oneYearAgo) {\n\t\t\tdateContainer.classList.add('rtbs-library-date--danger')\n\t\t} else if (date < sixMonthsAgo) {\n\t\t\tdateContainer.classList.add('rtbs-library-date--warning')\n\t\t}\n\t} else {\n\t\tdateInput.value = ''\n\t}\n\n\tdateContainer.classList.remove('rtbs-library-date--loading')\n}\n\nfunction extractRepoFromUrl(url) {\n\tconst match = url.match(/github\\.com\\/([^\\/]+)\\/([^\\/]+)/)\n\treturn match ? `${match[1]}/${match[2]}` : null\n}\n\nasync function fetchLatestReleaseDate(repo) {\n\ttry {\n\t\tconst response = await fetch(`https://api.github.com/repos/${repo}/releases/latest`)\n\t\tif (response.ok) {\n\t\t\tconst data = await response.json()\n\t\t\treturn data.published_at ? new Date(data.published_at) : null\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('Error fetching release data:', error)\n\t}\n\treturn null\n}\n\nasync function getLatestReleaseDate(entry, repositoryInput) {\n\tconst repo = extractRepoFromUrl(repositoryInput.value)\n\tconst dateContainer = entry.querySelector('.rtbs-library-date')\n\n\tdateContainer.classList.add('rtbs-library-date--loading')\n\n\tif (repo && repositoryInput.checkValidity()) {\n\t\tconst releaseDate = await fetchLatestReleaseDate(repo)\n\t\tupdateLatestReleaseDateDisplay(entry, releaseDate)\n\t} else {\n\t\tupdateLatestReleaseDateDisplay(entry, null)\n\t}\n}\n\nfunction getNextEntryIndex(container, itemSelector) {\n\tconst allEntries = container.querySelectorAll(itemSelector)\n\treturn allEntries.length\n}\n\nfunction updateEntryAttributes(entry, index, fieldPrefix) {\n\tconst inputs = entry.querySelectorAll('input')\n\tconst labels = entry.querySelectorAll('label')\n\n\tinputs.forEach((input) => {\n\t\tif (input.name && input.name.includes(`${fieldPrefix}[`)) {\n\t\t\tconst fieldName = input.name.match(/\\[([^\\]]+)\\]$/)?.[1]\n\t\t\tif (fieldName) {\n\t\t\t\tinput.name = `${fieldPrefix}[${index}][${fieldName}]`\n\t\t\t\tinput.id = `${fieldPrefix}[${index}][${fieldName}]`\n\t\t\t}\n\t\t}\n\t})\n\n\tlabels.forEach((label) => {\n\t\tif (label.getAttribute('for') && label.getAttribute('for').includes(`${fieldPrefix}[`)) {\n\t\t\tconst fieldName = label.getAttribute('for').match(/\\[([^\\]]+)\\]$/)?.[1]\n\t\t\tif (fieldName) {\n\t\t\t\tlabel.setAttribute('for', `${fieldPrefix}[${index}][${fieldName}]`)\n\t\t\t}\n\t\t}\n\t})\n}\n\nfunction addRepeatedEntryLogic(entry, container, itemSelector, fieldPrefix, emptyEntryNode) {\n\tconst entryInputs = entry.querySelectorAll('input')\n\tconst repositoryInput = entry.querySelector('input[name*=\"[repository]\"]')\n\n\tif (repositoryInput) {\n\t\trepositoryInput.addEventListener('blur', () => {\n\t\t\tconsole.log(`Fetching latest release date for repository: ${repositoryInput.value}`)\n\t\t\tgetLatestReleaseDate(entry, repositoryInput)\n\t\t})\n\t}\n\n\tentry.addEventListener('input', () => {\n\t\tconst lastEntryIsValid = Array.from(entryInputs).every(\n\t\t\t(input) => input.readOnly || (input.checkValidity() && input.value.length > 0)\n\t\t)\n\n\t\tif (lastEntryIsValid) {\n\t\t\tconst allEntries = container.querySelectorAll(itemSelector)\n\t\t\tconst lastEntry = allEntries[allEntries.length - 1]\n\n\t\t\tif (lastEntry === entry) {\n\t\t\t\tconst newEntry = emptyEntryNode.cloneNode(true)\n\t\t\t\tconst nextIndex = getNextEntryIndex(container, itemSelector)\n\t\t\t\tupdateEntryAttributes(newEntry, nextIndex, fieldPrefix)\n\t\t\t\tnewEntry.querySelectorAll('input').forEach((input) => (input.value = ''))\n\t\t\t\tcontainer.appendChild(newEntry)\n\t\t\t\taddRepeatedEntryLogic(newEntry, container, itemSelector, fieldPrefix, emptyEntryNode)\n\t\t\t}\n\t\t} else {\n\t\t\tconst lastEntry = container.querySelector(`${itemSelector}:last-child`)\n\t\t\tif (lastEntry && lastEntry !== entry) {\n\t\t\t\tconst allInputsEmpty = Array.from(lastEntry.querySelectorAll('input')).every(\n\t\t\t\t\t(input) => input.value.length === 0\n\t\t\t\t)\n\n\t\t\t\tif (allInputsEmpty) {\n\t\t\t\t\tlastEntry.remove()\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})\n}\n\nfunction initializeRepeatedFields(config) {\n\tconst { containerSelector, itemSelector, fieldPrefix } = config\n\n\tconst container = document.querySelector(`${containerSelector} .inside`)\n\tif (!container) return\n\n\tconst entries = container.querySelectorAll(itemSelector)\n\tconst emptyEntry = container.querySelector(`${itemSelector}:last-child`)\n\n\t// Initialize existing entries for repository fetching\n\tentries.forEach((entry) => {\n\t\tconst repositoryInput = entry.querySelector('input[name*=\"[repository]\"]')\n\t\tif (repositoryInput) {\n\t\t\tgetLatestReleaseDate(entry, repositoryInput)\n\t\t}\n\t})\n\n\t// Set up repeatable logic for the last entry\n\tif (emptyEntry) {\n\t\tconst emptyEntryNode = emptyEntry.cloneNode(true)\n\t\taddRepeatedEntryLogic(emptyEntry, container, itemSelector, fieldPrefix, emptyEntryNode)\n\t}\n}\n\n// Initialize libraries metabox\ninitializeRepeatedFields({\n\tcontainerSelector: '#rtbs-component-libraries',\n\titemSelector: '.rtbs-postbox-item--library',\n\tfieldPrefix: 'rtbs-libraries'\n})\n\n// Initialize references metabox\ninitializeRepeatedFields({\n\tcontainerSelector: '#rtbs-component-references',\n\titemSelector: '.rtbs-postbox-item--reference',\n\tfieldPrefix: 'rtbs-references'\n})\n"]}