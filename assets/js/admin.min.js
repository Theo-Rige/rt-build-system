document.querySelectorAll("#rtbs_component_libraries .rtbs-library"),document.querySelector("#rtbs_component_libraries .rtbs-library:last-child");function e(e,t){const r=e.querySelector(".rtbs-library-date"),n=e.querySelector('input[name*="[date]"]');if(r.classList.remove("rtbs-library-date--warning","rtbs-library-date--danger"),t){n.value=t.toLocaleDateString();const e=new Date,o=new Date(e),a=new Date(e);o.setMonth(e.getMonth()-6),a.setFullYear(e.getFullYear()-1),t<a?r.classList.add("rtbs-library-date--danger"):t<o&&r.classList.add("rtbs-library-date--warning")}else n.value="";r.classList.remove("rtbs-library-date--loading")}function t(e,r,n,o,a){const l=e.querySelectorAll("input");e.querySelector('input[name*="[repository]"]');e.addEventListener("input",()=>{if(Array.from(l).every(e=>e.readOnly||e.checkValidity()&&e.value.length>0)){const l=r.querySelectorAll(n);if(l[l.length-1]===e){const e=a.cloneNode(!0),l=function(e,t){return e.querySelectorAll(t).length}(r,n);!function(e,t,r){const n=e.querySelectorAll("input"),o=e.querySelectorAll("label");n.forEach(e=>{if(e.name&&e.name.includes(`${r}[`)){const n=e.name.match(/\[([^\]]+)\]$/)?.[1];n&&(e.name=`${r}[${t}][${n}]`,e.id=`${r}[${t}][${n}]`)}}),o.forEach(e=>{if(e.getAttribute("for")&&e.getAttribute("for").includes(`${r}[`)){const n=e.getAttribute("for").match(/\[([^\]]+)\]$/)?.[1];n&&e.setAttribute("for",`${r}[${t}][${n}]`)}})}(e,l,o),e.querySelectorAll("input").forEach(e=>e.value=""),r.appendChild(e),t(e,r,n,o,a)}}else{const t=r.querySelector(`${n}:last-child`);if(t&&t!==e){Array.from(t.querySelectorAll("input")).every(e=>0===e.value.length)&&t.remove()}}})}function r(r){const{containerSelector:n,itemSelector:o,fieldPrefix:a}=r,l=document.querySelector(`${n} .inside`);if(!l)return;const s=l.querySelectorAll(o),i=l.querySelector(`${o}:last-child`);if(s.forEach(t=>{const r=t.querySelector('input[name*="[date]"]');r&&r.value&&e(t,new Date(r.value))}),i){const e=i.cloneNode(!0);t(i,l,o,a,e)}}r({containerSelector:"#rtbs-component-libraries",itemSelector:".rtbs-postbox-item--library",fieldPrefix:"rtbs-libraries"}),r({containerSelector:"#rtbs-component-references",itemSelector:".rtbs-postbox-item--reference",fieldPrefix:"rtbs-references"}),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("rtbs-refresh-library-dates");t&&t.addEventListener("click",async r=>{r.preventDefault(),t.disabled=!0,t.textContent="Refreshing...";try{await async function(){if(!window.wp||!window.wp.data)return void console.warn("WordPress data API not available");const t=window.wp.data.select("core/editor")?.getCurrentPostId()||new URLSearchParams(window.location.search).get("post")||document.querySelector("#post_ID")?.value;if(!t)return void console.warn("Post ID not found");const r=new FormData;r.append("action","rtbs_refresh_library_dates"),r.append("id",t),r.append("_ajax_nonce",document.querySelector("#_wpnonce")?.value||"");try{const t=await fetch(window.ajaxurl||"/wp-admin/admin-ajax.php",{method:"POST",body:r}),n=await t.json();if(n.success){const t=n.data.libraries,r=document.querySelectorAll("#rtbs_component_libraries .rtbs-library");t.forEach((t,n)=>{const o=r[n];if(o&&t.date){const r=o.querySelector('input[name*="[date]"]');r&&(r.value=t.date,e(o,new Date(t.date)))}}),console.log("Library dates refreshed successfully")}else console.error("Failed to refresh library dates:",n.data?.message)}catch(e){console.error("Error refreshing library dates:",e)}}(),t.textContent="Refresh Complete!",setTimeout(()=>{t.textContent="Refresh Release Dates",t.disabled=!1},2e3)}catch(e){console.error("Error refreshing dates:",e),t.textContent="Refresh Failed",setTimeout(()=>{t.textContent="Refresh Release Dates",t.disabled=!1},2e3)}})});
//# sourceMappingURL=admin.min.js.map
